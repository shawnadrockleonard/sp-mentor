var mentor;!function(e){var t=function(){function t(){this.loading=ko.observable(!0),this.mentorExists=ko.observable(!1),this.updating=ko.observable(!1),this.created=ko.observable(!1),this.headerMessage=ko.observable(),this.headerClass=ko.observable("alert-danger"),this.notificationMessage=ko.observable(),this.notificationClass=ko.observable(),this.searchMentorName=ko.observable(),this.showButton=ko.observable(!0),this.showForm=ko.observable(!1),this.mentorCollection=ko.observableArray([]),this.mentorCollectionLoading=ko.observable(!1),this.mentorSearchCollection=ko.observableArray(new Array),this.mentorSearchLoading=ko.observable(!1),this.mentorSearchModifying=ko.observable(!1),this.mentorCollectionExists=ko.computed(function(){return"undefined"!=typeof this.mentorCollection()&&this.mentorCollection().length>0},this,{deferEvaluation:!0}),this.showNotification=ko.computed(function(){return!("undefined"==typeof this.notificationMessage()||!(this.notificationMessage().length>0||this.updating()))},this,{deferEvaluation:!0}),this.parseErrorThrown=function(e){var t=e;try{var o=jQuery.parseJSON(e);if(t=o.Message,"undefined"!=typeof o.ModelState){var n=jQuery.map(o.ModelState,function(e,t){return[e]});t=t.concat("<br />"),jQuery.each(n,function(e,o){o.length>0&&(t=t.concat(o[0]+"<br />"))})}}catch(e){}return t},this.load=function(){var e=this;this.sharepointContext.load(Function.createDelegate(this,function(t,o){e.sharepointContext.getHostWebDetails(),e.sharepointContext.getCurrentUser(function(t,o,n){var i=n.get_id(),r=n.get_title();n.get_loginName();e.mentor.mentorUserId(i),e.mentor.mentorName(r),console.log("User ID: "+i);var a='<View><Query><Where><Eq><FieldRef Name="MentorName" LookupId="TRUE" /><Value Type="User">'+i+'</Value></Eq></Where><OrderBy><FieldRef Name="Title" /></OrderBy></Query><RowLimit>1</RowLimit></View>';e.sharepointContext.listQuery("Mentors",a,function(t,o,n){for(var i=!1,r=n.getEnumerator();r.moveNext();){var a=r.get_current();e.mentor.mentorTitle(a.get_item("Title"));var s=a.get_item("MentorName");e.mentor.mentorName(s.get_lookupValue()),e.mentor.mentorBio(a.get_item("MentorBio")),e.mentor.optionCareer(a.get_item("MentorCareer")),e.mentor.optionTechnical(a.get_item("MentorTechnical")),e.mentor.optionPresentation(a.get_item("MentorPresentation")),e.mentor.mentorSkillsTechnical(a.get_item("MentorSkillsTechnical")),e.mentor.mentorSkillsProfessional(a.get_item("MentorSkillsProfessional")),e.mentor.mentorComments(a.get_item("MentorComments"));var l=a.get_item("MentorLkupCareer");e.mentor.mentorCareerText(l.get_lookupValue());var c=a.get_item("MentorLkupCommunity"),m="";jQuery.each(c,function(e,t){m+=t.get_lookupValue()+","}),e.mentor.mentorCommunityText(m);var u=a.get_item("MentorLkupCountry");e.mentor.mentorCountryText(u.get_lookupValue()),i=!0}e.mentorExists(i),e.showForm(!i),e.getUserRelationships()},function(e,t){console.log("Query mentor list failed: "+t.get_message())})},function(e,t){console.log("User Query Failed: "+t.get_message())});var n='<View><Query><OrderBy><FieldRef Name="SortOrder" Ascending="TRUE" /></OrderBy></Query><RowLimit>50</RowLimit></View>';e.sharepointContext.listQuery("Country",n,function(t,o,n){for(var i=n.getEnumerator(),r=[];i.moveNext();){var a=i.get_current();r.push({Value:a.get_id(),Text:a.get_item("Title")})}e.mentor.mentorCountryAvailable(r)},function(e,t){console.log(t.get_message())}),n='<View><Query><OrderBy><FieldRef Name="Title" /></OrderBy></Query><RowLimit>50</RowLimit></View>',e.sharepointContext.listQuery("Community",n,function(t,o,n){for(var i=n.getEnumerator(),r=[];i.moveNext();){var a=i.get_current();r.push({Value:a.get_id(),Text:a.get_item("Title")})}e.mentor.mentorCommunityAvailable(r)},function(e,t){console.log(t.get_message())}),n='<View><Query><Where><Eq><FieldRef Name="IsDeprecated" /><Value Type="Boolean">0</Value></Eq></Where><OrderBy><FieldRef Name="Title" /></OrderBy></Query><RowLimit>50</RowLimit></View>',e.sharepointContext.listQuery("Career",n,function(t,o,n){for(var i=n.getEnumerator(),r=[];i.moveNext();){var a=i.get_current();r.push({Value:a.get_id(),Text:a.get_item("Title")})}e.mentor.mentorCareerAvailable(r)},function(e,t){console.log(t.get_message())}),e.loading(!1)}),Function.createDelegate(this,function(e,t){}))},this.getUserInfo=function(){},this.submitUserInfo=function(){var e=this;e.notificationMessage(""),e.mentor.errors().length>0?(e.notificationClass("alert-danger"),e.notificationMessage("Correct form fields, then try again")):(e.showForm(!1),e.updating(!0),e.sharepointContext.saveMentor(e.mentor,function(t,o){console.log("Saving profile succeeded for: "+e.mentor.mentorName()),e.created(!0),e.updating(!1)},function(t,o){e.notificationMessage("Error occurred while saving profile: "+o.get_message()),e.updating(!1),e.showForm(!0)}))},this.editUserInfo=function(){},this.getUserRelationships=function(){var e=this;e.notificationMessage(""),jQuery.get("/api/mentor/"+location.search).done(function(t){e.mentorCollection(t)}).fail(function(t,o,n){e.notificationMessage(n)}).always(function(e,t){})},this.searchUserRelationships=function(){var e=this;e.notificationMessage(""),e.mentorSearchLoading(!0),jQuery.get("/api/mentor"+location.search+"&searchName="+e.searchMentorName()).done(function(t){e.mentorSearchCollection(t)}).fail(function(t,o,n){var i=e.parseErrorThrown(t.responseText);e.notificationMessage(i)}).always(function(t,o){e.mentorSearchLoading(!1)})},this.addUserRelationships=function(e,t){var o=this;o.notificationMessage(""),o.mentorSearchModifying(!0);var n={mentorId:e.IdentityObjectId,comments:null};jQuery.ajax({type:"POST",url:"/api/mentor/insert/"+location.search,data:ko.toJSON(n),contentType:"application/json; charset=utf-8",dataType:"json"}).done(function(e){o.notificationMessage(e),o.mentorSearchCollection.removeAll(),o.getUserRelationships()}).fail(function(e,t,n){o.notificationMessage(n)}).always(function(e,t){o.mentorSearchModifying(!1)})},this.removeUserRelationships=function(e,t){var o=this;o.notificationMessage(""),o.mentorSearchModifying(!0);var n={mentorId:e.IdentityObjectId,comments:null};jQuery.ajax({type:"POST",url:"/api/mentor/remove/"+location.search,data:ko.toJSON(n),contentType:"application/json; charset=utf-8",dataType:"json"}).done(function(e){o.notificationMessage(e),o.getUserRelationships()}).fail(function(e,t,n){o.notificationMessage(n)}).always(function(e,t){o.mentorSearchModifying(!1)})},this.saveUserRelationships=function(){},this.mentor=new e.MentorKnockoutModel,this.sharepointContext=new e.MentorContextModel}return t}();e.MentorContextViewModel=t}(mentor||(mentor={}));