ko.validation.init({messagesOnModified:!1,insertMessages:!1});var mentor;!function(e){var t=function(){function t(){this.loading=ko.observable(!0),this.mentorExists=ko.observable(!1),this.updating=ko.observable(!1),this.created=ko.observable(!1),this.headerMessage=ko.observable(),this.headerClass=ko.observable("alert-danger"),this.notificationMessage=ko.observable(""),this.notificationClass=ko.observable(),this.searchMentorName=ko.observable(),this.showButton=ko.observable(!0),this.showForm=ko.observable(!1),this.mentorCollection=ko.observableArray([]),this.mentorCollectionLoading=ko.observable(!1),this.mentorSearchCollection=ko.observableArray(new Array),this.mentorSearchLoading=ko.observable(!1),this.mentorSearchModifying=ko.observable(!1),this.mentorCollectionExists=ko.computed(function(){return"undefined"!=typeof this.mentorCollection()&&this.mentorCollection().length>0},this,{deferEvaluation:!0}),this.showNotification=ko.computed(function(){return!("undefined"==typeof this.notificationMessage()||!(this.notificationMessage().length>0||this.updating()))},this,{deferEvaluation:!0}),this.mentor=new e.MentorKnockoutModel,this.sharepointContext=new e.MentorContextModel}return t.prototype.parseErrorThrown=function(e){var t=e;try{var o=jQuery.parseJSON(e);if(t=o.Message,"undefined"!=typeof o.ModelState){var n=jQuery.map(o.ModelState,function(e,t){return[e]});t=t.concat("<br />"),jQuery.each(n,function(e,o){o.length>0&&(t=t.concat(o[0]+"<br />"))})}}catch(e){}return t},t.prototype.load=function(){var e=this;e.sharepointContext.load(function(t,o){e.sharepointContext.getHostWebDetails(),e.sharepointContext.getCurrentUser(function(t,o,n){var r=n.get_id(),i=n.get_title();n.get_loginName();e.mentor.mentorUserId(r),e.mentor.mentorName(i),console.log("User ID: "+r);var a='<View><Query><Where><Eq><FieldRef Name="MentorName" LookupId="TRUE" /><Value Type="User">'+r+'</Value></Eq></Where><OrderBy><FieldRef Name="Title" /></OrderBy></Query><RowLimit>1</RowLimit></View>';e.sharepointContext.listQuery("Mentors",a,function(t,o,n){for(var r=!1,i=n.getEnumerator();i.moveNext();){var a=i.get_current();e.mentor.mentorTitle(a.get_item("Title"));var s=a.get_item("MentorName");e.mentor.mentorName(s.get_lookupValue()),e.mentor.mentorBio(a.get_item("MentorBio")),e.mentor.optionCareer(a.get_item("MentorCareer")),e.mentor.optionTechnical(a.get_item("MentorTechnical")),e.mentor.optionPresentation(a.get_item("MentorPresentation")),e.mentor.mentorSkillsTechnical(a.get_item("MentorSkillsTechnical")),e.mentor.mentorSkillsProfessional(a.get_item("MentorSkillsProfessional")),e.mentor.mentorComments(a.get_item("MentorComments"));var l=a.get_item("MentorLkupCareer");e.mentor.mentorCareerText(l.get_lookupValue());var m=a.get_item("MentorLkupCommunity"),c="";jQuery.each(m,function(e,t){c+=t.get_lookupValue()+","}),e.mentor.mentorCommunityText(c);var u=a.get_item("MentorLkupCountry");e.mentor.mentorCountryText(u.get_lookupValue()),r=!0}e.mentorExists(r),e.showForm(!r),e.getUserRelationships()},function(e,t){console.log("Query mentor list failed: "+t.get_message())})},function(e,t){console.log("User Query Failed: "+t.get_message())});var n='<View><Query><OrderBy><FieldRef Name="SortOrder" Ascending="TRUE" /></OrderBy></Query><RowLimit>50</RowLimit></View>';e.sharepointContext.listQuery("Country",n,function(t,o,n){for(var r=n.getEnumerator(),i=[];r.moveNext();){var a=r.get_current();i.push({Value:a.get_id(),Text:a.get_item("Title")})}e.mentor.mentorCountryAvailable(i)},function(e,t){console.log(t.get_message())}),n='<View><Query><OrderBy><FieldRef Name="Title" /></OrderBy></Query><RowLimit>50</RowLimit></View>',e.sharepointContext.listQuery("Community",n,function(t,o,n){for(var r=n.getEnumerator(),i=[];r.moveNext();){var a=r.get_current();i.push({Value:a.get_id(),Text:a.get_item("Title")})}e.mentor.mentorCommunityAvailable(i)},function(e,t){console.log(t.get_message())}),n='<View><Query><Where><Eq><FieldRef Name="IsDeprecated" /><Value Type="Boolean">0</Value></Eq></Where><OrderBy><FieldRef Name="Title" /></OrderBy></Query><RowLimit>50</RowLimit></View>',e.sharepointContext.listQuery("Career",n,function(t,o,n){for(var r=n.getEnumerator(),i=[];r.moveNext();){var a=r.get_current();i.push({Value:a.get_id(),Text:a.get_item("Title")})}e.mentor.mentorCareerAvailable(i)},function(e,t){console.log(t.get_message())}),e.loading(!1)},function(e,t){})},t.prototype.getUserInfo=function(){},t.prototype.submitUserInfo=function(e,t){var o=this;o.notificationMessage(""),o.mentor.errors().length>0?(o.notificationClass("alert-danger"),o.notificationMessage("Correct form fields, then try again")):(o.showForm(!1),o.updating(!0),o.sharepointContext.saveMentor(o.mentor,function(e,t,n){console.log("Saving profile succeeded for: "+n.mentorName()),o.created(!0),o.updating(!1)},function(e,t){o.notificationMessage("Error occurred while saving profile: "+t.get_message()),o.updating(!1),o.showForm(!0)}))},t.prototype.editUserInfo=function(){},t.prototype.getUserRelationships=function(){var e=this;e.notificationMessage(""),jQuery.get("/api/mentor/"+location.search).done(function(t){e.mentorCollection(t)}).fail(function(t,o,n){e.notificationMessage(n)}).always(function(e,t){})},t.prototype.searchUserRelationships=function(){var e=this;e.notificationMessage(""),e.mentorSearchLoading(!0),jQuery.get("/api/mentor"+location.search+"&searchName="+e.searchMentorName()).done(function(t){e.mentorSearchCollection(t)}).fail(function(t,o,n){var r=e.parseErrorThrown(t.responseText);e.notificationMessage(r)}).always(function(t,o){e.mentorSearchLoading(!1)})},t.prototype.addUserRelationships=function(e,t){var o=this;o.notificationMessage(""),o.mentorSearchModifying(!0);var n={mentorId:e.IdentityObjectId,comments:null};jQuery.ajax({type:"POST",url:"/api/mentor/insert/"+location.search,data:ko.toJSON(n),contentType:"application/json; charset=utf-8",dataType:"json"}).done(function(e){o.notificationMessage(e),o.mentorSearchCollection.removeAll(),o.getUserRelationships()}).fail(function(e,t,n){o.notificationMessage(n)}).always(function(e,t){o.mentorSearchModifying(!1)})},t.prototype.removeUserRelationships=function(e,t){var o=this;o.notificationMessage(""),o.mentorSearchModifying(!0);var n={mentorId:e.IdentityObjectId,comments:null};jQuery.ajax({type:"POST",url:"/api/mentor/remove/"+location.search,data:ko.toJSON(n),contentType:"application/json; charset=utf-8",dataType:"json"}).done(function(e){o.notificationMessage(e),o.getUserRelationships()}).fail(function(e,t,n){o.notificationMessage(n)}).always(function(e,t){o.mentorSearchModifying(!1)})},t.prototype.saveUserRelationships=function(){},t}();e.MentorContextViewModel=t}(mentor||(mentor={}));var vm=new mentor.MentorContextViewModel;vm.mentor.errors=ko.validation.group(vm.mentor,{deep:!0}),ko.applyBindings(vm),vm.load();